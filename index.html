<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover'>
  <title>v6</title>
</head>

<body>
  <script src='https://static.line-scdn.net/liff/edge/2/sdk.js'></script>
  <script>
    const query = window.location.search.slice(1);
    const data = query.split(',');    
    
    async function main() {
      await liff.init({ liffId: '1657236240-AXK6lOrm' })
      if (liff.isInClient()) {
        alert('isInClient');
        sendShared()
      } else {
        if (liff.isLoggedIn()) {
          alert('isLoggedIn');
          sendShared()
        } else {
          alert('login');
          liff.login()
        }
      }
    }

    async function sendShared() {
      alert('sendShared');
      await liff.shareTargetPicker([
        {
          'type': 'flex',
          'altText': 'Flex Message',
          'contents': 
          
{
  'type': 'bubble',
  'body': {
    'type': 'box',
    'layout': 'vertical',
    'contents': [
      {
        'type': 'box',
        'layout': 'horizontal',
        'contents': [
          {
            'type': 'text',
            'text': 'ระบบรับเรื่องอัตโนมัติ',
            'color': '#1DB446',
            'weight': 'bold',
            'flex': 0
          },
          {
            'type': 'text',
            'text': '#' + 'data[0]',
            'align': 'end',
            'color': '#aaaaaa'
          }
        ]
      },
      {
        'type': 'text',
        'text': 'data[3]',
        'weight': 'bold',
        'size': 'xl',
        'margin': 'xs'
      },
      {
        'type': 'box',
        'layout': 'vertical',
        'contents': [
          {
            'type': 'box',
            'layout': 'horizontal',
            'contents': [
              {
                'type': 'text',
                'text': 'ผู้แจ้ง',
                'flex': 0,
                'color': '#555555'
              },
              {
                'type': 'text',
                'text': 'data[2]',
                'align': 'end'
              }
            ]
          },
          {
            'type': 'box',
            'layout': 'horizontal',
            'contents': [
              {
                'type': 'text',
                'text': 'โทรศัพท์',
                'flex': 0,
                'color': '#555555'
              },
              {
                'type': 'text',
                'text': '0' + 'data[8]',
                'align': 'end'
              }
            ],
            'margin': 'sm',
            'action': {
              'type': 'message',
              'label': 'action',
              'text': '0' + 'data[8]'
            }
          },
          {
            'type': 'box',
            'layout': 'horizontal',
            'contents': [
              {
                'type': 'text',
                'text': 'สถานที่',
                'flex': 0,
                'color': '#555555'
              },
              {
                'type': 'text',
                'text': 'data[5]',
                'align': 'end'
              }
            ],
            'margin': 'sm',
            'action': {
              'type': 'uri',
              'label': 'action',
              'uri': 'location'
            }
          }
        ],
        'margin': 'xs'
      },
      {
        'type': 'separator',
        'margin': 'sm'
      },
      {
        'type': 'box',
        'layout': 'vertical',
        'contents': [
          {
            'type': 'box',
            'layout': 'horizontal',
            'contents': [
              {
                'type': 'text',
                'text': 'วันที่แจ้ง',
                'flex': 0,
                'color': '#1DB446',
                'weight': 'bold'
              },
              {
                'type': 'text',
                'text': 'showdate',
                'align': 'end'
              }
            ]
          },
          {
            'type': 'box',
            'layout': 'horizontal',
            'contents': [
              {
                'type': 'image',
                'url': 'smlimg',
                'size': 'full',
                'aspectMode': 'cover',
                'aspectRatio': '1.5:1'
              }
            ],
            'margin': 'sm',
            'action': {
              'type': 'uri',
              'label': 'action',
              'uri': 'midimg'
            }
          },
        ],
        'margin': 'md'
      },

      {
        'type': 'box',
        'layout': 'vertical',
        'contents': []
      }

    ],
    'paddingAll': 'xl'
  },

  'footer': {
    'type': 'box',
    'layout': 'vertical',
    'contents': [{
      'type': 'box',
      'layout': 'horizontal',
      'contents': [
        {
          'type': 'button',
          'action': {
            'type': 'postback',
            'label': 'รับทราบปัญหา',
            'displayText': 'รับเรื่องเรียบร้อย #' + '(index - 1)',
            'data': 'index' + ',รับเรื่อง'
          },
          'style': 'primary',
          'height': 'sm',
          'flex': 20
        },
        {
          'type': 'filler',
          'flex': 1
        },
        {
          'type': 'button',
          'action': {
            'type': 'uri',
            'label': 'ส่งต่อ',
            'uri': 'https://liff.line.me/1657234496-bJWNPRva'
          },
          'style': 'primary',
          'height': 'sm',
          'flex': 20
        }
      ]
    }]
  },

  'styles': {
    'footer': {
      'separator': true
    }
  }
}
          
        }
      ])
      liff.closeWindow()
    }
    main()
    
    function text2date(date) {
      var showdate = date.getDate() + ' ' + (thMonth[date.getMonth()])
        + ' ' + (date.getFullYear() - 1957)
        + ' - ' + date.getHours() + ':' + ('0' + date.getMinutes()).slice(-2) + ' น.';
      return showdate
    }
    
  </script>
</body>

</html>
