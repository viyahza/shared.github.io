<!DOCTYPE html>
<html>

<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover'>
  <title>v3</title>
</head>

<body>
  <script src='https://static.line-scdn.net/liff/edge/2.5.0/sdk.js'></script>
  <script>
    const queryString = window.location.search.slice(1);
    alert(queryString);
    const data = queryString.split(',');
    alert(data[0]);

    async function main() {
      await liff.init({ liffId: '1657236240-AXK6lOrm' })
      await liff.shareTargetPicker([
        {
          'type': 'flex',
          'altText': 'Flex Message',
          'contents': 

            {
              'type': 'bubble',
              'body': {
                'type': 'box',
                'layout': 'vertical',
                'contents': [
                  {
                    'type': 'box',
                    'layout': 'horizontal',
                    'contents': [
                      {
                        'type': 'text',
                        'text': 'ระบบรับเรื่องอัตโนมัติ',
                        'color': '#1DB446',
                        'weight': 'bold',
                        'flex': 0
                      },
                      {
                        'type': 'text',
                        'text': '#' + 'data[0]',
                        'align': 'end',
                        'color': '#aaaaaa'
                      }
                    ]
                  },
                  {
                    'type': 'text',
                    'text': 'data[3]',
                    'weight': 'bold',
                    'size': 'xl',
                    'margin': 'xs'
                  },
                  {
                    'type': 'box',
                    'layout': 'vertical',
                    'contents': [
                      {
                        'type': 'box',
                        'layout': 'horizontal',
                        'contents': [
                          {
                            'type': 'text',
                            'text': 'ผู้แจ้ง',
                            'flex': 0,
                            'color': '#555555'
                          },
                          {
                            'type': 'text',
                            'text': 'data[2]',
                            'align': 'end'
                          }
                        ]
                      },
                      {
                        'type': 'box',
                        'layout': 'horizontal',
                        'contents': [
                          {
                            'type': 'text',
                            'text': 'โทรศัพท์',
                            'flex': 0,
                            'color': '#555555'
                          },
                          {
                            'type': 'text',
                            'text': '0' + 'ata[8]',
                            'align': 'end'
                          }
                        ],
                        'margin': 'sm',
                        'action': {
                          'type': 'message',
                          'label': 'action',
                          'text': '0' + 'data[8]'
                        }
                      },
                      {
                        'type': 'box',
                        'layout': 'horizontal',
                        'contents': [
                          {
                            'type': 'text',
                            'text': 'สถานที่',
                            'flex': 0,
                            'color': '#555555'
                          },
                          {
                            'type': 'text',
                            'text': 'data[5]',
                            'align': 'end'
                          }
                        ],
                        'margin': 'sm',
                        'action': {
                          'type': 'uri',
                          'label': 'action',
                          'uri': 'https://maps.google.com?q=' + 'data[6]' + ',' + 'data[7]'
                        }
                      }
                    ],
                    'margin': 'xs'
                  },
                  {
                    'type': 'separator',
                    'margin': 'sm'
                  },
                  {
                    'type': 'box',
                    'layout': 'vertical',
                    'contents': [
                      {
                        'type': 'box',
                        'layout': 'horizontal',
                        'contents': [
                          {
                            'type': 'text',
                            'text': 'วันที่แจ้ง',
                            'flex': 0,
                            'color': '#1DB446',
                            'weight': 'bold'
                          },
                          {
                            'type': 'text',
                            'text': 'text2date(data[9])',
                            'align': 'end'
                          }
                        ]
                      },
                      {
                        'type': 'box',
                        'layout': 'horizontal',
                        'contents': [
                          {
                            'type': 'image',
                            'url': 'https://lh3.googleusercontent.com/d/' + 'data[4]' + '=w280?authuser=0',
                            'size': 'full',
                            'aspectMode': 'cover',
                            'aspectRatio': '1.5:1'
                          }
                        ],
                        'margin': 'sm',
                        'action': {
                          'type': 'uri',
                          'label': 'action',
                          'uri': 'https://lh3.googleusercontent.com/d/' + 'data[4]' + '=w1280?authuser=0'
                        }
                      },
                    ],
                    'margin': 'md'
                  },
                  {
                    'type': 'box',
                    'layout': 'vertical',
                    'contents': []
                  }
                ],
                'paddingAll': 'xl'
              },
              'footer': {
                'type': 'box',
                'layout': 'vertical',
                'contents': [
                  {
                    'type': 'box',
                    'layout': 'horizontal',
                    'contents': [
                      {
                        'type': 'button',
                        'action': {
                          'type': 'postback',
                          'label': 'รับเรื่อง',
                          'displayText': 'รับเรื่องเรียบร้อย #' + '(data[0] - 1)',
                          'data': 'data[0]' + ',รับเรื่อง'
                        },
                        'style': 'primary',
                        'height': 'sm',
                        'flex': 20
                      },
                      {
                        'type': 'filler',
                        'flex': 1
                      },
                      {
                        'type': 'button',
                        'action': {
                          'type': 'uri',
                          'label': 'ส่งต่อ',
                          'uri': 'https://liff.line.me/1657234496-bJWNPRva/?'
                        },
                        'style': 'primary',
                        'height': 'sm',
                        'flex': 20
                      }
                    ]
                  }                  
                ]
              },
              'styles': {
                'footer': {
                  'separator': true
                }
              }
            }
        }
      ])
//       liff.closeWindow()
    }
    main()

  function text2date(date) {
    var thMonth = ['ม.ค.', 'ก.พ.', 'มี.ค.', 'เม.ย.', 'พ.ค.', 'มิ.ย.', 'ก.ค.', 'ส.ค.', 'ก.ย.', 'ต.ค.', 'พ.ย.', 'ธ.ค.'];
    var showdate = date.getDate() + ' ' + (thMonth[date.getMonth()])
      + ' ' + (date.getFullYear() - 1957)
      + ' - ' + date.getHours() + ':' + ('0' + date.getMinutes()).slice(-2) + ' น.';
    return showdate
  }

  </script>
</body>

</html>
